'use client';

import React, { useMemo } from "react";
import { Paper, Stack, Group, Text } from "@mantine/core";
import { useParams, useRouter } from "next/navigation";
import { Route } from "next";
import classes from "./menu-nav.module.scss";
import { IMenuResponse } from "@/interfaces/menu-interface";
import { TreeManager } from "@/helpers/tree-manager-helper";

interface MenuNavProps {
  menusData: IMenuResponse[];
}

export default function MenuNav({ menusData }: MenuNavProps) {
  const router = useRouter();
  const { id } = useParams();

  const treeManager = useMemo(() => {
    if (menusData.length === 0) {
      return null;
    }
    return new TreeManager(menusData);
  }, [menusData]);

  const isActiveMenu = (menuId: string) => {
    return id === menuId;
  };

  const renderMenuTree = () => {
    const root = treeManager?.getRoot();
    if (!root || !root.children) {
      return null;
    }
    return root.children?.map(child =>
      renderMenuBar(child, 0)
    );
  };

  const renderMenuBar = (menu: IMenuResponse, depth: number = 0): React.ReactNode => {
    return (
      <React.Fragment key={menu.id}>
        <Stack
          key={menu.id}
          className={`${classes.navItem} ${isActiveMenu(menu.id) ? classes.active : ''}`}
          bd={'1px solid #c7c7c7'}
          bdrs={'sm'}
          p={'8px'}
          ml={depth * 16}
          onClick={() => { router.push(`/admin/menu/${menu.id}` as Route); }}
        >
          <Group key={menu.id}>
            <Text fw={isActiveMenu(menu.id) ? 'bold' : 'normal'}>{menu.title}</Text>
          </Group>
        </Stack>
        <>
          {menu.children?.map((child) => renderMenuBar(child, depth + 1))}
        </>
      </React.Fragment>
    );
  };

  return (
    <Paper p={'sm'} radius={'md'} shadow="xs" withBorder>
      <Stack gap={'xs'}>
        {renderMenuTree()}
      </Stack>
    </Paper>
  );
}
